<!-- sentiment_correlation.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment Correlation</title>
</head>
<body>
    <header>
        <h1>Sentiment & Delta Correlation</h1>
        <a href="index.html">Back to Homepage</a>
    </header>
    <main>
        <div id="stock-selector">
            <h2>Select Stock</h2>
            <select id="stockDropdown">
                <option value="AAPL">AAPL</option>
                <option value="AMZN">AMZN</option>
                <option value="GOOGL">GOOGL</option>
                <option value="META">META</option>
                <option value="MSFT">MSFT</option>
            </select>
        </div>
        <div id="correlation-chart">
            <h2>Correlation Plot</h2>
            <canvas id="scatterChart"></canvas>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Function to load CSV data for a specific stock
        async function loadCSVData(stock) {
            const response = await fetch(`single_stock/${stock}.csv`);
            const csvText = await response.text();
            const rows = csvText.trim().split('\n').map(row => row.split(','));
            const headers = rows[0];
            const data = rows.slice(1).map(row => {
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header] = row[index] !== '' ? parseFloat(row[index]) || row[index] : null;
                });
                return obj;
            });
            return data;
        }

        // Populate chart with selected stock data
        async function updateChart(stock, chart) {
            const data = await loadCSVData(stock);
            const scatterData = data.map(row => ({
                x: row.all_score,
                y: row.real_delta
            }));

            const predDeltaData = data.map(row => ({
                x: row.all_score,
                y: row.pred_delta
            }));

            chart.data.datasets[0].data = scatterData;
            chart.data.datasets[1].data = predDeltaData;
            chart.update();
        }

        // Initialize dropdown and chart
        async function initialize() {
            const stockDropdown = document.getElementById('stockDropdown');
            const chartContext = document.getElementById('scatterChart').getContext('2d');

            const scatterChart = new Chart(chartContext, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Sentiment vs Real Delta',
                            data: [],
                            backgroundColor: 'red',
                        },
                        {
                            label: 'Sentiment vs Pred Delta',
                            data: [],
                            backgroundColor: 'blue',
                        }
                    ]
                },
            });

            stockDropdown.addEventListener('change', async (event) => {
                const selectedStock = event.target.value;
                await updateChart(selectedStock, scatterChart);
            });

            // Trigger initial chart update for the first stock
            await updateChart(stockDropdown.value, scatterChart);
        }

        // Initialize on load
        initialize();
    </script>
</body>
</html>
